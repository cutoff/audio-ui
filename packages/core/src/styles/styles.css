/*
 * Copyright (c) 2026 Tylium.
 * SPDX-License-Identifier: GPL-3.0-only OR LicenseRef-TELF
 * See LICENSE.md for details.
 */

@import url("themes.css");

/* ==========================================================================
   SVG and Icon Styles
   ========================================================================== */

/* Prevent text selection in SVG content (scoped to library components only) */
.audioui svg text,
.audioui svg foreignObject div {
    -webkit-user-select: none;
    user-select: none;
    cursor: default;
}

/* Make inline SVGs in knob content inherit text color (scoped to library components only) */
/* This works for inline <svg> elements and SVG components from libraries like react-icons */
.audioui svg foreignObject div svg {
    fill: currentColor;
    color: inherit;
    /* Ensure SVG icons scale down to fit, creating a visual margin */
    max-width: 75%;
    max-height: 75%;
}

/* Icon wrapper class for HTML overlay - ensures SVG icons fill their container */
/* Used by CycleButton and other components that render icons in the overlay */
.audioui-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Ensure SVG icons inside the wrapper fill the container and inherit color */
/* Icons automatically inherit text color via currentColor */
.audioui-icon-wrapper svg {
    width: 100%;
    height: 100%;
    fill: currentColor;
    color: inherit;
}

/* ==========================================================================
   Component Base Classes
   ========================================================================== */

/* Root class for all AudioUI components */
.audioui {
    font-family: var(--audioui-font-family);
    font-size: var(--audioui-font-size);
    font-weight: var(--audioui-font-weight);
    -webkit-user-select: none;
    user-select: none;
    cursor: default;
}

/* ==========================================================================
   Reactive CSS Variable Engine (Internal - Subject to Change)
   ========================================================================== */

/*
 * CRITICAL: These variables use the compound selector `.audioui, :root` to achieve
 * both global availability AND per-component reactivity with a single definition.
 *
 * How the compound selector works:
 * - Applied to :root = Global availability (computed from root-level base variables)
 * - Applied to .audioui = Per-component reactivity (recomputed from component-scoped base variables)
 *
 * When a component sets style={{ "--audioui-primary-color": "red" }}, the browser:
 * 1. Uses .audioui rule (matches the component's class)
 * 2. Re-evaluates formulas against the new base value in the component's scope
 * 3. Automatically updates all derived variants for that component only
 *
 * This is the "reactive engine" that makes per-component theming possible while
 * maintaining global availability for non-component contexts - all with DRY principle.
 */

.audioui,
:root {
    /* Color Variants - Transparency */
    --audioui-adaptive-50: color-mix(in srgb, var(--audioui-adaptive-default-color) 50%, transparent);
    --audioui-adaptive-20: color-mix(in srgb, var(--audioui-adaptive-default-color) 20%, transparent);
    --audioui-primary-50: color-mix(in srgb, var(--audioui-primary-color) 50%, transparent);
    --audioui-primary-20: color-mix(in srgb, var(--audioui-primary-color) 20%, transparent);

    /* Color Variants - Luminosity */
    --audioui-adaptive-light: color-mix(in srgb, var(--audioui-adaptive-default-color) 80%, white);
    --audioui-adaptive-dark: color-mix(in srgb, var(--audioui-adaptive-default-color) 80%, black);
    --audioui-primary-lighter: color-mix(in srgb, var(--audioui-primary-color) 80%, white);
    --audioui-primary-darker: color-mix(in srgb, var(--audioui-primary-color) 80%, black);

    /* Component-Specific Roundness */
    --audioui-roundness-button: calc(var(--audioui-roundness-base) * 50px);
    --audioui-roundness-knob: var(--audioui-roundness-base);
    --audioui-roundness-slider: calc(var(--audioui-roundness-base) * 20px);
    --audioui-roundness-keys: calc(var(--audioui-roundness-base) * 12px);

    /* Slider Component - Reactive Pointer Variables */
    /* These pointers reference reactive variants and must be redefined here for reactivity */
    --audioui-slider-track-color: var(--audioui-adaptive-20);
    --audioui-slider-cursor-border-color: var(--audioui-primary-lighter);

    /* Size System - Square Components (1x1) */
    --audioui-size-square-xsmall: calc(var(--audioui-unit) * var(--audioui-size-mult-xsmall));
    --audioui-size-square-small: calc(var(--audioui-unit) * var(--audioui-size-mult-small));
    --audioui-size-square-normal: calc(var(--audioui-unit) * var(--audioui-size-mult-normal));
    --audioui-size-square-large: calc(var(--audioui-unit) * var(--audioui-size-mult-large));
    --audioui-size-square-xlarge: calc(var(--audioui-unit) * var(--audioui-size-mult-xlarge));

    /* Size System - Horizontal Slider (1x2) */
    --audioui-size-hslider-height-xsmall: calc(var(--audioui-unit) * var(--audioui-size-mult-xsmall));
    --audioui-size-hslider-height-small: calc(var(--audioui-unit) * var(--audioui-size-mult-small));
    --audioui-size-hslider-height-normal: calc(var(--audioui-unit) * var(--audioui-size-mult-normal));
    --audioui-size-hslider-height-large: calc(var(--audioui-unit) * var(--audioui-size-mult-large));
    --audioui-size-hslider-height-xlarge: calc(var(--audioui-unit) * var(--audioui-size-mult-xlarge));

    --audioui-size-hslider-width-xsmall: calc(var(--audioui-size-hslider-height-xsmall) * 2);
    --audioui-size-hslider-width-small: calc(var(--audioui-size-hslider-height-small) * 2);
    --audioui-size-hslider-width-normal: calc(var(--audioui-size-hslider-height-normal) * 2);
    --audioui-size-hslider-width-large: calc(var(--audioui-size-hslider-height-large) * 2);
    --audioui-size-hslider-width-xlarge: calc(var(--audioui-size-hslider-height-xlarge) * 2);

    /* Size System - Vertical Slider (2x1) */
    --audioui-size-vslider-width-xsmall: calc(var(--audioui-unit) * var(--audioui-size-mult-xsmall));
    --audioui-size-vslider-width-small: calc(var(--audioui-unit) * var(--audioui-size-mult-small));
    --audioui-size-vslider-width-normal: calc(var(--audioui-unit) * var(--audioui-size-mult-normal));
    --audioui-size-vslider-width-large: calc(var(--audioui-unit) * var(--audioui-size-mult-large));
    --audioui-size-vslider-width-xlarge: calc(var(--audioui-unit) * var(--audioui-size-mult-xlarge));

    --audioui-size-vslider-height-xsmall: calc(var(--audioui-size-vslider-width-xsmall) * 2);
    --audioui-size-vslider-height-small: calc(var(--audioui-size-vslider-width-small) * 2);
    --audioui-size-vslider-height-normal: calc(var(--audioui-size-vslider-width-normal) * 2);
    --audioui-size-vslider-height-large: calc(var(--audioui-size-vslider-width-large) * 2);
    --audioui-size-vslider-height-xlarge: calc(var(--audioui-size-vslider-width-xlarge) * 2);

    /* Size System - Keys (1x5) */
    --audioui-size-keys-height-xsmall: calc(var(--audioui-unit) * var(--audioui-size-mult-xsmall));
    --audioui-size-keys-height-small: calc(var(--audioui-unit) * var(--audioui-size-mult-small));
    --audioui-size-keys-height-normal: calc(var(--audioui-unit) * var(--audioui-size-mult-normal));
    --audioui-size-keys-height-large: calc(var(--audioui-unit) * var(--audioui-size-mult-large));
    --audioui-size-keys-height-xlarge: calc(var(--audioui-unit) * var(--audioui-size-mult-xlarge));

    --audioui-size-keys-width-xsmall: calc(var(--audioui-size-keys-height-xsmall) * 5);
    --audioui-size-keys-width-small: calc(var(--audioui-size-keys-height-small) * 5);
    --audioui-size-keys-width-normal: calc(var(--audioui-size-keys-height-normal) * 5);
    --audioui-size-keys-width-large: calc(var(--audioui-size-keys-height-large) * 5);
    --audioui-size-keys-width-xlarge: calc(var(--audioui-size-keys-height-xlarge) * 5);
}

/* Container helper class for components that manage their own SVG sizing */
.audioui-component-container {
    height: auto;
    max-width: 100%;
    max-height: 100%;
}

/* Remove default outline from SVG elements */
.audioui-component-container svg {
    height: auto;
    outline: none;
}

/* ==========================================================================
   Interactive States and Accessibility
   ========================================================================== */

/* Highlight effect for interactive components */
/* Uses --audioui-highlight-effect from themes.css (user-customizable) */
/*
 * CSS isolation on text and foreignObject elements prevents the filter from affecting them,
 * allowing the filter to affect only the SVG graphics (paths, circles, etc.) without
 * requiring manual filter resets. This is cleaner than resetting filters on each element type.
 */
.audioui-highlight {
    will-change: filter;
    /* Fast transition for realtime audio UI - instant feedback preferred */
    transition: filter var(--audioui-highlight-transition-duration) linear;
}

/* Apply highlight on hover OR when focused (keyboard/click) */
/* The actual effect is defined by --audioui-highlight-effect in themes.css */
/* Using :is() for cleaner selector grouping (modern browsers) */
.audioui-highlight:hover,
.audioui-highlight:focus,
.audioui-highlight:focus-visible {
    filter: var(--audioui-highlight-effect);
    outline: none; /* Remove default browser focus ring */
}

/* Prevent filter from affecting text elements by isolating them */
.audioui-highlight text {
    isolation: isolate;
}

/* Prevent filter from affecting foreignObject elements (HTML content) by isolating them */
.audioui-highlight foreignObject {
    isolation: isolate;
}

/* ==========================================================================
   Color Utility Classes
   ========================================================================== */

/* Base utility classes - only work if --audioui-primary-color is set by user */
.audioui-stroke-primary {
    stroke: var(--audioui-primary-color);
}

.audioui-fill-text {
    fill: var(--audioui-text-color);
}

.audioui-fill-primary {
    fill: var(--audioui-primary-color);
}

.audioui-fill-transparent {
    fill: transparent;
}

.audioui-border-primary {
    border-color: var(--audioui-primary-color);
}

.audioui-text-primary {
    color: var(--audioui-primary-color);
}

/* ==========================================================================
   Image Dark Mode Support
   ========================================================================== */

/* Light mode: show light image, hide dark image */
.audioui-image-light {
    display: block;
}

.audioui-image-dark {
    display: none;
}

/* Dark mode (.dark class): hide light image, show dark image */
.dark .audioui-image-dark {
    display: block;
}

.dark .audioui-image-light {
    display: none;
}

/* Also support system preference when .dark class not present */
@media (prefers-color-scheme: dark) {
    :root:not(.dark) .audioui-image-dark {
        display: block;
    }
    :root:not(.dark) .audioui-image-light {
        display: none;
    }
}

/* ==========================================================================
   Size Utility Classes
   ========================================================================== */

/* Square components (Button, Knob, CycleButton) - 1x1 aspect ratio */
.audioui-size-square-xsmall {
    width: var(--audioui-size-square-xsmall);
    height: var(--audioui-size-square-xsmall);
}

.audioui-size-square-small {
    width: var(--audioui-size-square-small);
    height: var(--audioui-size-square-small);
}

.audioui-size-square-normal {
    width: var(--audioui-size-square-normal);
    height: var(--audioui-size-square-normal);
}

.audioui-size-square-large {
    width: var(--audioui-size-square-large);
    height: var(--audioui-size-square-large);
}

.audioui-size-square-xlarge {
    width: var(--audioui-size-square-xlarge);
    height: var(--audioui-size-square-xlarge);
}

/* Horizontal Slider (1x2 aspect ratio - width > height) */
.audioui-size-hslider-xsmall {
    width: var(--audioui-size-hslider-width-xsmall);
    height: var(--audioui-size-hslider-height-xsmall);
}

.audioui-size-hslider-small {
    width: var(--audioui-size-hslider-width-small);
    height: var(--audioui-size-hslider-height-small);
}

.audioui-size-hslider-normal {
    width: var(--audioui-size-hslider-width-normal);
    height: var(--audioui-size-hslider-height-normal);
}

.audioui-size-hslider-large {
    width: var(--audioui-size-hslider-width-large);
    height: var(--audioui-size-hslider-height-large);
}

.audioui-size-hslider-xlarge {
    width: var(--audioui-size-hslider-width-xlarge);
    height: var(--audioui-size-hslider-height-xlarge);
}

/* Vertical Slider (2x1 aspect ratio - height > width) */
.audioui-size-vslider-xsmall {
    width: var(--audioui-size-vslider-width-xsmall);
    height: var(--audioui-size-vslider-height-xsmall);
}

.audioui-size-vslider-small {
    width: var(--audioui-size-vslider-width-small);
    height: var(--audioui-size-vslider-height-small);
}

.audioui-size-vslider-normal {
    width: var(--audioui-size-vslider-width-normal);
    height: var(--audioui-size-vslider-height-normal);
}

.audioui-size-vslider-large {
    width: var(--audioui-size-vslider-width-large);
    height: var(--audioui-size-vslider-height-large);
}

.audioui-size-vslider-xlarge {
    width: var(--audioui-size-vslider-width-xlarge);
    height: var(--audioui-size-vslider-height-xlarge);
}

/* Keys (1x5 aspect ratio - width > height) */
.audioui-size-keys-xsmall {
    width: var(--audioui-size-keys-width-xsmall);
    height: var(--audioui-size-keys-height-xsmall);
}

.audioui-size-keys-small {
    width: var(--audioui-size-keys-width-small);
    height: var(--audioui-size-keys-height-small);
}

.audioui-size-keys-normal {
    width: var(--audioui-size-keys-width-normal);
    height: var(--audioui-size-keys-height-normal);
}

.audioui-size-keys-large {
    width: var(--audioui-size-keys-width-large);
    height: var(--audioui-size-keys-height-large);
}

.audioui-size-keys-xlarge {
    width: var(--audioui-size-keys-width-xlarge);
    height: var(--audioui-size-keys-height-xlarge);
}

/* ==========================================================================
   Dark Mode Reactive Overrides
   ========================================================================== */

/* Dark mode reactive overrides for the reactive engine */
.dark .audioui,
.dark:root {
    --audioui-slider-cursor-border-color: var(--audioui-primary-darker);
}
